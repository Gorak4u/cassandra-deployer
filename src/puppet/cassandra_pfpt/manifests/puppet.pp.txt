# @summary Manages the Puppet agent itself, including scheduled runs.
#
# This class now creates a file in /etc/cron.d to schedule Puppet agent runs.
#
# Optionally set $puppet_cron_schedule (e.g., '*/30 * * * *') in Hiera to override the default.
class cassandra_pfpt::puppet inherits cassandra_pfpt {
  # If a schedule is passed via Hiera, use it. Otherwise, default to every 30 minutes.
  $schedule = $puppet_cron_schedule ? {
    undef   => '*/30 * * * *',
    default => $puppet_cron_schedule,
  }

  # The command checks for a disable-flag before running the agent.
  $command = '[ ! -f /var/lib/puppet-disabled ] && /opt/puppetlabs/bin/puppet agent -v --onetime'

  file { '/etc/cron.d/puppet-agent':
    ensure  => 'file',
    owner   => 'root',
    group   => 'root',
    mode    => '0644',
    content => "${schedule} root ${command}\n",
  }
}
